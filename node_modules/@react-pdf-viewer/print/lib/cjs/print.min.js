"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core"),n=require("react-dom");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,o=r(e),i=function(){return o.default.createElement(t.Icon,{size:16},o.default.createElement("path",{d:"M7.5,19.499h9 M7.5,16.499h9 M5.5,16.5h-3c-1.103-0.003-1.997-0.897-2-2v-6c0.003-1.103,0.897-1.997,2-2h19\n                c1.103,0.003,1.997,0.897,2,2v6c-0.003,1.103-0.897,1.997-2,2h-3\n                M5.5,4.5v-4h9.586c0.265,0,0.52,0.105,0.707,0.293l2.414,2.414\n                C18.395,3.394,18.5,3.649,18.5,3.914V4.5\n                M18.5,22.5c0,0.552-0.448,1-1,1h-11c-0.552,0-1-0.448-1-1v-9h13V22.5z\n                M3.5,8.499\n                c0.552,0,1,0.448,1,1s-0.448,1-1,1s-1-0.448-1-1S2.948,8.499,3.5,8.499z\n                M14.5,0.499v4h4"}))},c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u={left:0,top:8},l=function(n){var r=n.onClick,a=e.useContext(t.LocalizationContext),c=a&&a.print?a.print.print:"Print";return o.default.createElement(t.Tooltip,{position:t.Position.BottomCenter,target:o.default.createElement(t.Button,{onClick:r},o.default.createElement(i,null)),content:function(){return c},offset:u})};!function(e){e.Inactive="Inactive",e.Preparing="Preparing",e.Cancelled="Cancelled",e.Ready="Ready"}(a||(a={}));var d=a,p=function(e){var t=e.children,n=e.store;return(t||function(e){return o.default.createElement(l,{onClick:e.onClick})})({onClick:function(){n.update("printStatus",d.Preparing)}})},s=function(n){var r=n.numLoadedPages,a=n.numPages,i=n.onCancel,c=n.onStartPrinting,u=e.useContext(t.LocalizationContext),l=Math.floor(100*r/a);return e.useEffect((function(){r===a&&c()}),[r]),o.default.createElement("div",{className:"rpv-print-progress"},o.default.createElement("div",{className:"rpv-print-progress-inner"},o.default.createElement("div",{className:"rpv-print-progress-message"},u&&u.print?u.print.preparingDocument:"Preparing document ..."),o.default.createElement("div",{className:"rpv-print-progress-bar"},o.default.createElement(t.ProgressBar,{progress:l})),o.default.createElement(t.PrimaryButton,{onClick:i},u&&u.print?u.print.cancel:"Cancel")))},f=function(n){var r=n.page,a=n.pageHeight,i=n.pageWidth,c=n.rotation,u=n.onLoad,l=e.useRef(),d=e.useState(""),p=d[0],s=d[1];return e.useEffect((function(){var e=l.current;e&&e.cancel();var t=document.createElement("canvas");t.height=Math.floor(a*(150/72)),t.width=Math.floor(i*(150/72));var n=t.getContext("2d");n.save(),n.fillStyle="rgb(255, 255, 255)",n.fillRect(0,0,t.width,t.height),n.restore();var o=r.getViewport({rotation:c,scale:1});l.current=r.render({canvasContext:n,intent:"print",transform:[150/72,0,0,150/72,0,0],viewport:o}),l.current.promise.then((function(){"toBlob"in t?t.toBlob((function(e){s(URL.createObjectURL(e))})):s(t.toDataURL())}),(function(){}))}),[]),p?o.default.createElement("div",{className:"rpv-print-page-thumbnail",style:{height:Math.floor(96*a/72)+"px",width:Math.floor(96*i/72)+"px"}},o.default.createElement("img",{src:p,style:{height:Math.floor(96*a/72)+"px",width:Math.floor(96*i/72)+"px"},onLoad:u})):o.default.createElement(t.Spinner,null)},g=function(n){var r=n.doc,a=n.pageHeight,i=n.pageIndex,c=n.pageWidth,u=n.rotation,l=n.onLoad,d=e.useState({height:a,page:null,viewportRotation:0,width:c}),p=d[0],s=d[1],g=p.page,h=p.height,m=p.width,v=Math.abs(u)%180==0;e.useEffect((function(){r.getPage(i+1).then((function(e){var t=e.getViewport({scale:1});s({height:t.height,page:e,viewportRotation:t.rotation,width:t.width})}))}),[]);var E=(u+p.viewportRotation)%360;return g?o.default.createElement(f,{page:g,pageHeight:v?h:m,pageWidth:v?m:h,rotation:E,onLoad:l}):o.default.createElement(t.Spinner,null)},h=function(t){var r=t.doc,a=t.pageHeight,i=t.pageWidth,c=t.printStatus,u=t.rotation,l=t.onCancel,p=t.onLoad,s=e.useState(0),f=s[0],h=s[1];e.useEffect((function(){c===d.Ready&&(document.body.classList.add("rpv-body-printing"),window.print());var e=function(){c===d.Ready&&(document.body.classList.remove("rpv-body-printing"),l())};return document.addEventListener("mousemove",e),function(){return document.removeEventListener("mousemove",e)}}),[c]);var m=r.numPages,v=function(){var e=f+1;h(e),p(e)};return n.createPortal(o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"rpv-print-zone"},Array(m).fill(0).map((function(e,t){return o.default.createElement(g,{key:t,doc:r,pageHeight:a,pageIndex:t,pageWidth:i,rotation:u,onLoad:v})}))),o.default.createElement("style",{dangerouslySetInnerHTML:{__html:"\n                            @supports ((size:A4) and (size:1pt 1pt)) {\n                                @page { size: "+i+"pt "+a+"pt }\n                            }\n                        "}})),document.body)},m=function(t){var n=t.doc,r=t.pageHeight,a=t.pageWidth,i=t.rotation,c=t.store,u=e.useState(d.Inactive),l=u[0],p=u[1],f=e.useState(0),g=f[0],m=f[1],v=function(){m(0),p(d.Inactive)},E=function(e){return p(e)};return e.useEffect((function(){return c.subscribe("printStatus",E),function(){c.unsubscribe("printStatus",E)}}),[]),o.default.createElement(o.default.Fragment,null,l===d.Preparing&&o.default.createElement(s,{numLoadedPages:g,numPages:n.numPages,onCancel:v,onStartPrinting:function(){m(0),p(d.Ready)}}),(l===d.Preparing||l===d.Ready)&&o.default.createElement(h,{doc:n,pageHeight:r,pageWidth:a,printStatus:l,rotation:i,onCancel:v,onLoad:m}))};exports.PrintIcon=i,exports.printPlugin=function(){var e=t.createStore({printStatus:d.Inactive}),n=function(t){return o.default.createElement(p,c({},t,{store:e}))};return{renderViewer:function(t){var n=t.slot,r={children:o.default.createElement(o.default.Fragment,null,o.default.createElement(m,{doc:t.doc,pageHeight:t.pageHeight,pageWidth:t.pageWidth,rotation:t.rotation,store:e}),n.children)};return c(c({},n),r)},Print:n,PrintButton:function(){return o.default.createElement(n,null,(function(e){return o.default.createElement(l,c({},e))}))}}};
