"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),a=function(){return n.default.createElement(t.Icon,{size:16},n.default.createElement("path",{d:"M12,1.001c6.075,0,11,4.925,11,11s-4.925,11-11,11s-11-4.925-11-11S5.925,1.001,12,1.001z\n                M14.5,17.005H13\n                c-0.552,0-1-0.448-1-1v-6.5c0-0.276-0.224-0.5-0.5-0.5H10\n                M11.745,6.504L11.745,6.504\n                M11.745,6.5c-0.138,0-0.25,0.112-0.25,0.25\n                S11.607,7,11.745,7s0.25-0.112,0.25-0.25S11.883,6.5,11.745,6.5"}))},o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},l=function(r){var a=r.doc,o=r.render,l=e.useState(),i=l[0],u=l[1];return e.useEffect((function(){a.getMetadata().then((function(e){return Promise.resolve(e)})).then((function(e){return a.getDownloadInfo().then((function(t){return Promise.resolve({fileName:e.contentDispositionFilename||"",info:e.info,length:t.length})}))})).then((function(e){u(e)}))}),[]),i?o(i):n.default.createElement("div",{className:"rpv-properties-loader"},n.default.createElement(t.Spinner,null))},i=function(e){var t=e.label,r=e.value;return n.default.createElement("dl",{className:"rpv-property-item"},n.default.createElement("dt",{className:"rpv-property-item-label"},t,":"),n.default.createElement("dd",{className:"rpv-property-item-value"},r||"-"))},u=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"),c=function(e,t,r,n){var a=parseInt(e,10);return a>=t&&a<=r?a:n},p=function(r){var a=r.doc,o=r.fileName,p=r.onToggle,s=e.useContext(t.LocalizationContext),f=function(e){var t=function(e){var t=u.exec(e);if(!t)return null;var r=parseInt(t[1],10),n=c(t[2],1,12,1)-1,a=c(t[3],1,31,1),o=c(t[4],0,23,0),l=c(t[5],0,59,0),i=c(t[6],0,59,0),p=t[7]||"Z",s=c(t[8],0,23,0),f=c(t[9],0,59,0);switch(p){case"-":o+=s,l+=f;break;case"+":o-=s,l-=f}return new Date(Date.UTC(r,n,a,o,l,i))}(e);return t?t.toLocaleDateString()+", "+t.toLocaleTimeString():""};return n.default.createElement("div",{className:"rpv-properties-modal"},n.default.createElement(l,{doc:a,render:function(e){return n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"rpv-properties-modal-group"},n.default.createElement(i,{label:s&&s.properties?s.properties.fileName:"File name",value:e.fileName||(u=o,c=u.split("/").pop(),c?c.split("#")[0].split("?")[0]:u)}),n.default.createElement(i,{label:s&&s.properties?s.properties.fileSize:"File size",value:(r=e.length,l=Math.floor(Math.log(r)/Math.log(1024)),(r/Math.pow(1024,l)).toFixed(2)+" "+["B","kB","MB","GB","TB"][l])})),n.default.createElement(t.Separator,null),n.default.createElement("div",{className:"rpv-properties-modal-group"},n.default.createElement(i,{label:s&&s.properties?s.properties.title:"Title",value:e.info.Title}),n.default.createElement(i,{label:s&&s.properties?s.properties.author:"Author",value:e.info.Author}),n.default.createElement(i,{label:s&&s.properties?s.properties.subject:"Subject",value:e.info.Subject}),n.default.createElement(i,{label:s&&s.properties?s.properties.keywords:"Keywords",value:e.info.Keywords}),n.default.createElement(i,{label:s&&s.properties?s.properties.creator:"Creator",value:e.info.Creator}),n.default.createElement(i,{label:s&&s.properties?s.properties.creationDate:"Creation date",value:f(e.info.CreationDate)}),n.default.createElement(i,{label:s&&s.properties?s.properties.modificationDate:"Modification date",value:f(e.info.ModDate)})),n.default.createElement(t.Separator,null),n.default.createElement("div",{className:"rpv-properties-modal-group"},n.default.createElement(i,{label:s&&s.properties?s.properties.pdfProducer:"PDF producer",value:e.info.Producer}),n.default.createElement(i,{label:s&&s.properties?s.properties.pdfVersion:"PDF version",value:e.info.PDFFormatVersion}),n.default.createElement(i,{label:s&&s.properties?s.properties.pageCount:"Page count",value:""+a.numPages})));var r,l,u,c}}),n.default.createElement("div",{className:"rpv-properties-modal-footer"},n.default.createElement(t.PrimaryButton,{onClick:p},s&&s.properties?s.properties.close:"Close")))},s={left:0,top:8},f=function(r){var o=r.onClick,l=e.useContext(t.LocalizationContext),i=l&&l.properties?l.properties.showProperties:"Show properties";return n.default.createElement(t.Tooltip,{position:t.Position.BottomCenter,target:n.default.createElement(t.Button,{onClick:o},n.default.createElement(a,null)),content:function(){return i},offset:s})},d=function(r){var a=r.children,l=r.store,i=function(t){var r=e.useState(t.get("doc")),n=r[0],a=r[1],o=function(e){a(e)};return e.useEffect((function(){return t.subscribe("doc",o),function(){t.unsubscribe("doc",o)}}),[]),{currentDoc:n}}(l).currentDoc,u=l.get("fileName")||"",c=a||function(e){return n.default.createElement(f,o({},e))};return i?n.default.createElement(t.Modal,{target:function(e){return c({onClick:e})},content:function(e){return n.default.createElement(p,{doc:i,fileName:u,onToggle:e})},closeOnClickOutside:!0,closeOnEscape:!0}):n.default.createElement(n.default.Fragment,null)},m=function(r){var o=r.onClick,l=e.useContext(t.LocalizationContext),i=l&&l.properties?l.properties.showProperties:"Show properties";return n.default.createElement(t.MenuItem,{icon:n.default.createElement(a,null),onClick:o},i)};exports.InfoIcon=a,exports.propertiesPlugin=function(){var e=t.createStore({fileName:""}),r=function(t){return n.default.createElement(d,o({},t,{store:e}))};return{onDocumentLoad:function(t){e.update("doc",t.doc)},onViewerStateChange:function(t){return e.update("fileName",t.file.name),t},ShowProperties:r,ShowPropertiesButton:function(){return n.default.createElement(d,{store:e})},ShowPropertiesMenuItem:function(e){return n.default.createElement(r,null,(function(e){return n.default.createElement(m,o({},e))}))}}};
